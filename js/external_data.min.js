function getEarthquake(){var a="http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/4.5_week.geojson";$.get("https://u4h2tjydjl.execute-api.us-west-2.amazonaws.com/remotepixel/https?url="+a).done(function(b){map.getSource("earthquakes").setData(b)})}function getEONETEvents(){var a="http://eonet.sci.gsfc.nasa.gov/api/v2.1/events";$.get("https://u4h2tjydjl.execute-api.us-west-2.amazonaws.com/remotepixel/https?url="+a).done(function(g){var c={type:"FeatureCollection",features:[]},f,b;for(f=0;f<g.events.length;f++){var h=g.events[f],k="marker";switch(h.categories[0].title){case"Volcanoes":k="volcano";break;default:k="marker"}if(h.geometries.length>1){for(b=0;b<h.geometries.length;b++){var d={};d.properties={dtype:h.categories[0].title,id:h.id,description:h.description,code:h.categories[0].id,link:h.link,sources:JSON.stringify(h.sources),title:h.title,icon:k};d.properties.date=h.geometries[b].date;d.geometry={type:"Point",coordinates:h.geometries[b].coordinates};c.features.push(d)}}else{var d={};d.properties={dtype:h.categories[0].title,id:h.id,description:h.description,code:h.categories[0].id,link:h.link,sources:JSON.stringify(h.sources),title:h.title,icon:k};d.properties.date=h.geometries[0].date;d.geometry={type:"Point",coordinates:h.geometries[0].coordinates};c.features.push(d)}}map.getSource("eonet").setData(c)})}function getL8S2Images(d,e){var b=$.map($(".disaster-images .sat-filter input:checked"),function(f){return f.getAttribute("data")});var a={intersects:d,date_from:"2016-01-01",date_to:moment.utc().format("YYYY-MM-DD"),limit:2000},c=[];$.ajax({url:"https://api.developmentseed.org/satellites/",type:"POST",data:JSON.stringify(a),dataType:"json",contentType:"application/json"}).success(function(j){if(j.hasOwnProperty("errorMessage")){console.log("DevSeed Sat-API servers Error");return e(null)}if(j.meta.found!==0){var k={};for(var g=0;g<j.results.length;g+=1){k={};k.date=j.results[g].date;k.cloud=j.results[g].cloud_coverage;k.sceneID=j.results[g].scene_id;if(j.results[g].satellite_name==="landsat-8"){k.sat="landsat-8";k.path=j.results[g].path.toString();k.row=j.results[g].row.toString();k.grid=j.results[g].path+"/"+j.results[g].row;k.usgsURL=j.results[g].cartURL;k.browseURL=j.results[g].browseURL.replace("http://","https://");k.AWSurl="http://landsat-pds.s3.amazonaws.com/L8/"+zeroPad(j.results[g].path,3)+"/"+zeroPad(j.results[g].row,3)+"/"+j.results[g].sceneID+"/";k.sumAWSurl="https://landsatonaws.com/L8/"+zeroPad(j.results[g].path,3)+"/"+zeroPad(j.results[g].row,3)+"/"+j.results[g].sceneID;c.push(k)}else{k.sat="sentinel-2";k.utm_zone=j.results[g].utm_zone.toString();k.grid_square=j.results[g].grid_square;k.coverage=j.results[g].data_coverage_percentage;k.latitude_band=j.results[g].latitude_band;k.browseURL=j.results[g].thumbnail.replace(".jp2",".jpg");k.path=j.results[g].aws_path.replace("tiles","#tiles");k.AWSurl="http://sentinel-s2-l1c.s3-website.eu-central-1.amazonaws.com/"+k.path+"/";k.grid=k.utm_zone+k.latitude_band+k.grid_square;c.push(k)}}}for(var g=0;g<c.length;g+=1){var l=c[g],h;if(l.sat==="landsat-8"){if(b.indexOf("landsat8")===-1){h="item display-none"}else{h="item"}var f="['all', ['==', 'PATH', "+l.path+"], ['==', 'ROW', "+l.row+"]]";$(".img-preview").append('<div sat="landsat8" img-date="'+l.date+'" class="'+h+'" onmouseover="hoverL8('+f+")\" onmouseout=\"hoverL8(['all', ['==', 'PATH', ''], ['==', 'ROW', '']])\"><img class=\"img-item img-responsive lazy lazyload\" data-src=\""+l.browseURL+'"><div class="result-overlay"><span>'+l.sceneID+'</span><span><i class="fa fa-calendar-o"></i> '+l.date+'</span><span><i class="fa fa-cloud"></i> '+l.cloud+'%</span><span>Link:</span><div class="btnDD" onclick="feeddownloadL8(\''+l.AWSurl+"','"+l.sceneID+'\')"><i class="fa fa-download"></i></div><a target="_blank" href="'+l.sumAWSurl+'"><img src="/img/aws.png"> </a><a target="_blank" href="'+l.usgsURL+'"><img src="/img/usgs.jpg"></a></div></div>')}else{if(b.indexOf("sentinel2")===-1){h="item display-none"}else{h="item"}var f="['==', 'Name', '"+l.grid+"']";$(".img-preview").append('<div sat="sentinel2" img-date="'+l.date+'" class="'+h+'" onmouseover="hoverS2('+f+")\" onmouseout=\"hoverS2(['in', 'Name', ''])\"><img class=\"img-item img-responsive lazy lazyload\" data-src=\""+l.browseURL+'"><div class="result-overlay"><span>'+l.sceneID+'</span><span><i class="fa fa-calendar-o"></i> '+l.date+'</span><span><i class="fa fa-cloud"></i> '+l.cloud+'%</span><span>Link:</span><div class="btnDD" onclick="feeddownloadS2(\''+l.path.replace("#tiles","tiles")+"','"+l.browseURL+'\')"><i class="fa fa-download"></i></div><a target="_blank" href="'+l.AWSurl+'"><img src="/img/aws.png"> </a></div></div>')}}return e(null,c.length)}).fail(function(){console.log("DevSeed Sat-API servers Error");return e(null)})}function getS1Images(b,c){var a=$.map($(".disaster-images .sat-filter input:checked"),function(d){return d.getAttribute("data")});$.ajax({url:"https://fzzc9dpwij.execute-api.us-west-2.amazonaws.com/prod/getS1images",type:"POST",data:JSON.stringify(b),dataType:"json",contentType:"application/json",}).success(function(j){if(j.hasOwnProperty("errorMessage")){console.log("DisasterWatch API servers Error");return c(null)}var e={type:"FeatureCollection",features:[]};for(var f=0;f<j.length;f+=1){var k=j[f],h;var g={properties:{id:k.sceneID},type:"Feature",geometry:k.geometry};e.features.push(g);if(a.indexOf("sentinel1")===-1){h="item display-none"}else{h="item"}var d="['in', 'id', '"+k.sceneID+"']";$(".img-preview").append('<div sat="sentinel1" img-date="'+k.date+'" class="'+h+'" onmouseover="hoverS1('+d+')" onmouseout="hoverS1([\'==\', \'id\', \'\'])"><img class="lazy img-responsive" src="/img/sentinel1.jpg"><div class="result-overlay"><span> S1A_IW_SLC'+moment(k.fullDate).utc().format("YYYYMMDD_hhmmss")+'</span><span><i class="fa fa-calendar-o"></i> '+k.date+'</span><span><i class="ms ms-satellite"></i> '+k.orbType.slice(0,4)+" | "+k.refOrbit+"</span><span> Pol: "+k.polarisation+' | SLC </span><span>Link:</span><a target="_blank" href="'+k.esaURL+'"><img src="/img/esa.png"> </a></div></div>')}map.getSource("sentinel-1").setData(e);return c(null,j.length)}).fail(function(d){console.log("DisasterWatch API servers Error");return c(null)})}function getImages(){$(".disaster-images .spin-load").removeClass("display-none");$(".img-preview").empty();var a=draw.getAll();if(a.features[0].geometry.type==="Point"){var c=mapboxgl.LngLat.convert(a.features[0].geometry.coordinates).wrap().toArray();a.features[0].geometry.coordinates=c}else{a.features[0].geometry.coordinates[0]=a.features[0].geometry.coordinates[0].map(function(d){return mapboxgl.LngLat.convert(d).wrap().toArray()})}var b=d3.queue().defer(getL8S2Images,a.features[0]).defer(getS1Images,a.features[0]).awaitAll(function(f,d){$(".disaster-images .spin-load").addClass("display-none");sortListImage();if(!d[0]&&!d[1]){$(".img-preview").append('<div class="serv-error"><span>Error: Cannot connect to APIs</span><div class="center-block"><button class="btn btn-default" onclick="getImages()">Retry</button></div>')}else{var g=0;if(d.length!==0){for(var e=0;e<d.length;e++){if(d[e]){g+=d[e]}}}if(g===0){$(".img-preview").append('<span class="nodata-error">No image found</span>')}}})}function seeEQimages(a){$(".map .spin").removeClass("display-none");draw.deleteAll();if(draw.getMode()!=="static"){draw.changeMode("static")}$.get("https://u4h2tjydjl.execute-api.us-west-2.amazonaws.com/remotepixel/https?url="+a).done(function(d){var f=draw.add(d.geometry),c=draw.getAll();if(c.features[0].geometry.type==="Point"){var b=turf.buffer(c.features[0],100,"kilometers"),e=turf.extent(b);map.fitBounds(e,{padding:20})}addType(document.getElementById("dropdown-menu").getElementsByClassName("earthquake")[0].parentElement);document.getElementById("disasterName").value=d.properties.title;document.getElementById("disasterPlace").value=d.properties.place;document.getElementById("disasterStartDate").value=moment(d.properties.time).utc().format("YYYY-MM-DD");document.getElementById("disasterEndDate").value=moment(d.properties.time).utc().format("YYYY-MM-DD");document.getElementById("disasterComments").value=d.properties.url;openleftBlock();getImages();$(".map .spin").addClass("display-none")});closePopup()}function seeEONETimages(b){$(".map .spin").removeClass("display-none");draw.deleteAll();if(draw.getMode()!=="static"){draw.changeMode("static")}var a="http://eonet.sci.gsfc.nasa.gov/api/v2.1/events/"+b;$.get("https://u4h2tjydjl.execute-api.us-west-2.amazonaws.com/remotepixel/https?url="+a).done(function(g){if(g.geometries.length>1){var e={type:"LineString",coordinates:[]},d;for(d=0;d<g.geometries.length;d++){e.coordinates.push(g.geometries[d].coordinates)}}else{var e={type:"Point",coordinates:g.geometries[0].coordinates}}var i=draw.add(e),f=draw.getAll();if(f.features[0].geometry.type==="LineString"){var h=turf.extent(f.features[0].geometry);map.fitBounds(h,{padding:20})}if(f.features[0].geometry.type==="Point"){var c=turf.buffer(f.features[0],100,"kilometers"),h=turf.extent(c);map.fitBounds(h,{padding:20})}$(".tab-selector-1").addClass("out");$(".tab-selector-2").addClass("out");openleftBlock();getImages();$(".map .spin").addClass("display-none")});closePopup()}$("#s1-checkbox").change(function(){$("#s1-checkbox").parent().toggleClass("green")});